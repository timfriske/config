#!/usr/bin/env bash
#
# Find file system objects w/ Find for Fzf
# ========================================
# Tim Friske <me@tifr.de>
#
# Dependencies::
#   _Bash_, _Cat_

shopt -os nounset pipefail errexit errtrace

function print_help {
  1>&2 cat \
<<'HELP'
Help
====
Find file system objects with _Find_ for _Fzf_.

Usage
-----
.Command line syntax
----
fzf-find [--help]
----

Options
-------
--help::
  Print this program's help text.

The program _Fzf-find_ finds file system objects below the current
folder with _Find_ for further consumption by _Fzf_.  By default it will
only find visible objects, i.e. those whose names don't start with the
`.` dot sign.  This also excludes visible objects in hidden folders.

File systems which are known to contain objects of low interest, i.e.
those in which the user doesn't search for objects on a regular basis
are excluded from search and therefore their contents not printed.
These are currently `sysfs`, `devfs`, `devtmpfs` and `proc`.

HELP
}

function find_fs_objects {
  find -L -mindepth 1 \
    \( \
      -path '*/.*' \
      -o -fstype sysfs \
      -o -fstype devfs \
      -o -fstype devtmpfs \
      -o -fstype proc \
    \) \
    -prune \
    -o -print
}

function fzf_find {
  if [[ "${1:-}" == '--help' ]]; then
    print_help
    exit
  fi

  find_fs_objects
}

fzf_find "$@"
