#!/usr/bin/env bash
#
# Git Location
# ============
# Tim Friske <tifr@me.de>
#
# Display the location, i.e. the _Git_ branch, tag or commit at which
# the symbolic ref `HEAD` points.

shopt -os nounset pipefail errexit errtrace

function get_branch {
  git symbolic-ref --quiet --short "${ref:-HEAD}"
}

function get_tag {
  git describe --tags --exact-match "${ref:-HEAD}" 2> /dev/null
}

function get_commit {
  git rev-parse --short "${ref:-HEAD}"
}

function git_location {
  local branch="$(get_branch)"
  if [[ -n "$branch" ]]; then
    printf '%s\n' "$branch"
    exit 0
  fi

  local tag="$(get_tag)"
  if [[ -n "$tag" ]]; then
    printf '%s\n' "$tag"
    exit 0
  fi

  local commit="$(get_commit)"
  if [[ -n "$commit" ]]; then
    printf '%s\n' "$commit"
    exit 0
  fi

  exit 1
}

git_location "$@"
